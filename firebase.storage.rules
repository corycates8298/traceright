rules_version = '2';

// Set the service to Firebase Storage
service firebase.storage {
  // Match all files in the bucket
  match /b/{bucket}/o {
  
    // Rule for user profile pictures.
    // Allow any authenticated user to upload their own profile picture.
    match /users/{userId}/profile.jpg {
      allow read;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Rules for general uploads in the 'uploads' folder.
    match /uploads/{fileName} {
      // Any authenticated user can read (download) any file.
      allow read: if request.auth != null;

      // Only admins can write (upload, update, delete) files.
      // This rule checks for a custom claim 'isAdmin' on the user's auth token.
      // You must set this claim on the user via a Cloud Function for this to work.
      allow write: if request.auth != null && request.auth.token.isAdmin == true;

      // File validation: Ensure files are under 10MB.
      // You can also add contentType validation here.
      // e.g., if request.resource.contentType.matches('image/.*')
      allow create: if request.resource.size < 10 * 1024 * 1024;
    }
  }
}
